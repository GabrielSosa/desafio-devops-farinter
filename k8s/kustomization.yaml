apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

resources:
- app/deployment.yaml
- app/service.yaml
- app/hpa.yaml
- kong/ingress.yaml
- kong/tls-issuer.yaml
- kong/auth-plugin.yaml
- kong/consumer.yaml

images:
- name: ghcr.io/GabrielSosa/desafio-devops-farinter
  newName: ghcr.io/GabrielSosa/desafio-devops-farinter
  newTag: sha-cc95941
- name: ghcr.io/gabrielsosa/desafio-devops-farinter
  newTag: latest

# Configuración dinámica inyectada por CI/CD
# El pipeline generará un patch para modificar esto según la rama
configMapGenerator:
- literals:
  - ENVIRONMENT="production"
  - LOG_LEVEL="info"
  name: app-config

patches:
- patch: |-
    - op: add
      path: /spec/template/spec/containers/0/envFrom
      value:
      - configMapRef:
          name: app-config
  target:
    kind: Deployment
    name: saldo-api
